<!DOCTYPE html>
<html lang="zh-Hant">
<head>
<meta charset="utf-8">
<title>經期觀測站 - 家屬端</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<style>
body { background:#f4ede4; font-family:Arial; color:#4b3f2f; padding:20px; }
h2 { text-align:center; color:#6d4b3a; }
.card { background:#fff8ef; padding:15px; border-radius:12px; box-shadow:0 3px 6px rgba(0,0,0,0.1); margin-bottom:20px; }
button { padding:12px; width:100%; border:none; background:#c9a37c; color:white; border-radius:8px; }
</style>
</head>
<body>

<h2>經 期 觀 測 站 - 家 屬 端</h2>

<div class="card">
    <h3>輸入病人姓名</h3>
    <input id="fname" placeholder="例如：小美">
    <button onclick="loadStatus()">查看狀態</button>
</div>

<div class="card">
    <h3>今日摘要</h3>
    <div id="summary">尚未載入</div>
</div>

<script>
const server="https://hapi.fhir.org/baseR4";
let patientId=null;

async function loadStatus(){
    let name=document.getElementById("fname").value;
    let r=await fetch(`${server}/Patient?name=${name}`);
    let d=await r.json();
    if(!d.entry){ document.getElementById("summary").textContent="查無此人"; return; }
    patientId=d.entry[0].resource.id;

    let r2=await fetch(`${server}/Observation?subject=Patient/${patientId}&_sort=-date`);
    let d2=await r2.json();

    let latest={pain:"無", mood:"無", stress:"無", flow:"無"};
    (d2.entry||[]).slice(0,20).forEach(e=>{
        let o=e.resource;
        if(o.code.text==="疼痛程度") latest.pain=o.valueQuantity.value;
        if(o.code.text==="心情") latest.mood=o.valueString;
        if(o.code.text==="壓力指數") latest.stress=o.valueQuantity.value;
        if(o.code.text==="出血量") latest.flow=o.valueString;
    });

    document.getElementById("summary").innerHTML=`
        <b>心情：</b>${latest.mood}<br>
        <b>壓力：</b>${latest.stress}<br>
        <b>疼痛：</b>${latest.pain}<br>
        <b>出血量：</b>${latest.flow}<br>
    `;
}
</script>

</body>
</html>
