<!DOCTYPE html>
<html lang="zh-Hant">
<head>
<meta charset="utf-8">
<title>經期觀測站 - 醫護端</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<style>
body { background:#e8dfd3; font-family:Arial; color:#4b3f2f; padding:20px; }
h2 { text-align:center; color:#6d4b3a; }
.card { background:#fffaf3; padding:15px; border-radius:10px; box-shadow:0 3px 6px rgba(0,0,0,0.1); margin-bottom:20px; }
input { width:100%; padding:8px; margin:5px 0 10px; border-radius:6px; border:1px solid #d8c3a5; }
button { width:100%; padding:12px; border:none; background:#c9a37c; color:white; border-radius:8px; }
table { width:100%; border-collapse:collapse; }
td,th { border:1px solid #d8c3a5; padding:6px; }
</style>
</head>
<body>

<h2>經 期 觀 測 站 - 醫 護 端</h2>

<div class="card">
    <h3>搜尋病人</h3>
    <input id="pname" placeholder="輸入病人姓名">
    <button onclick="searchPatient()">搜尋</button>
</div>

<div class="card">
    <h3>病人資料</h3>
    <div id="info">尚未選擇病人</div>
</div>

<div class="card">
    <h3>觀測紀錄</h3>
    <table id="obsTable">
        <tr><th>日期</th><th>項目</th><th>數值</th></tr>
    </table>
</div>

<script>
const server="https://hapi.fhir.org/baseR4";
let patientId=null;

async function searchPatient(){
    let name=document.getElementById("pname").value;
    let r=await fetch(`${server}/Patient?name=${name}`);
    let d=await r.json();
    if(!d.entry){ document.getElementById("info").textContent="查無此人"; return; }
    let p=d.entry[0].resource;
    patientId=p.id;
    document.getElementById("info").textContent=`姓名：${name}｜ID：${patientId}`;
    loadObs();
}

async function loadObs(){
    let r=await fetch(`${server}/Observation?subject=Patient/${patientId}&_sort=-date`);
    let d=await r.json();
    let tb=document.getElementById("obsTable");
    tb.innerHTML="<tr><th>日期</th><th>項目</th><th>數值</th></tr>";
    (d.entry||[]).forEach(e=>{
        let o=e.resource;
        let val=o.valueQuantity?o.valueQuantity.value:(o.valueString||"");
        tb.innerHTML+=`<tr><td>${o.effectiveDateTime?.substring(0,10) || ""}</td><td>${o.code.text}</td><td>${val}</td></tr>`;
    });
}
</script>

</body>
</html>
